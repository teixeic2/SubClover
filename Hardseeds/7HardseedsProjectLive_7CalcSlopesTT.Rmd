---
title: "Hardseeds Slopes 6CV"
author: "CT"
date: "Tuesday, July 19, 2016"
output:
  word_document: default
  pdf_document: default
---
This script calculates the slopes for TT for hardseed breakdown:


reference : 7 days x 15/35 and 14 days at 40 

```{r loadLibraries}
library(tidyr)
library (dplyr)
library (ggplot2)
library(agricolae)
library(knitr)
library (lubridate)
library(markdown)

```


```{r loadFile}
setwd("C:\\GitHubRepos\\SubCloverPhD\\SubClover\\Hardseeds")
getwd()

#create file
df_seed <- read.table("dfHard_breakTT.txt",header=TRUE)

head(df_seed)
str(df_seed)
```


```{r}
df_seed%>%
  ggplot(aes(x=Days,y=TtSum)) +
  geom_point()
```


Just change name of dataframe
```{r}
#Select depth of interest start with above seeds 

dfSubSet<- df_seed%>%
  #filter (Depth== "Above")
 dplyr::select(Plot, Cultivar, Block, SowingD, SowTreat, Depth, TtSum, HardAccum)
  
```

subset data here to find means of Hardseeds at the end of the experiment 
```{r}


# dfEnd<- dfSubSet %>%
#   filter (TtSum == "1680")%>%
#   group_by( Cultivar, SowingD, SowTreat)%>%
#   dplyr::select(HardAccum)%>%
#   summarise_all(funs(mean, sd))


```




```{r}
all.data<-data.frame()
counter<-0
plots<-unique(dfSubSet$Plot)
depth<-unique(dfSubSet$Depth)

length(plots)*length(depth)
#p=d=1
for(p in 1:length(plots)) {
  for(d in 1:length(depth)) {
  df_sub <- data.frame()  
   # print(paste0(plots[p],"_",depth[d]))
  #  counter<-counter+1
    
  df_sub <- dfSubSet %>% filter(Plot==plots[p] & Depth == depth[d])
  
  
  # Linear fit
  x <- df_sub$TtSum
  y <- df_sub$HardAccum
  
  #print(data.frame(x=x,y=y))
  
  fit <- NULL
  fit <- lm(y ~ x)
  
  intercept <- round(fit$coefficients[[1]],2)
  slope <- round(fit$coefficients[[2]],3)
  r2 <- round(summary(fit)$r.squared * 100,2)
  # summary(fit)$adj.r.squared
  cv <- as.character(df_sub$Cultivar[1])
  block <- as.character(df_sub$Block[1])
  sow <- as.character(df_sub$SowTreat[1])
  sd <- dmy(df_sub$SowingD[1])
  
  
  buf <- data.frame(SowTreat=sow,Cultivar=cv, Block=block, plot=plots[p],depth=depth[d], int=intercept, slope=slope, r2=r2, n=nrow(df_sub))
  
  all.data <- rbind(buf, all.data)
  
 # print(buf)
  
  #print(nrow(df_sub))
    
  #subset(dfSubSet, (dfSubSet$Plot==plots[p] & Depth == depth[d]))
    
  }
  
}

summary(all.data)

```
write
```{r}
summary(dfSubSet)
summary(all.data)

df_av<-dfSubSet %>%
  filter(TtSum==0)%>%
  dplyr::select(Cultivar,SowTreat, Block, HardAccum) %>%
  group_by(Cultivar,SowTreat, Block) %>%
  summarise_all(funs(mean))

df_merged<-merge(all.data,df_av, by=c("Cultivar","SowTreat", "Block"))


df_merged%>%
  ggplot(aes(x=slope,y=as.numeric(HardAccum))) +
  geom_point()

```




```{r}
write.table(all.data, "df_slopesBreakTT.txt")
```



