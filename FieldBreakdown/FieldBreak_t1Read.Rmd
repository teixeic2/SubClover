---
title: "Hardseeds breakdown field"
author: "CT"
date: 07.09.2016"
output:
  word_document: default
  
---
Purpose : 
This script reads the raw data from the field seed hardness breakdown (buried mesh bags)
It calculates the percentage of germinated seeds and accumulated percentage of seedlings  

```{r loadLibraries}
library (lubridate)
library(tidyr)
library (dplyr)
library (ggplot2)
library(agricolae)
library(knitr)
library(rgr)
```

Read file and 
```{r, loadFile}
setwd("C:\\Users\\EdCarmen\\Documents\\CarmenProjects2016\\Gitsubclover\\FieldBreakdown")
getwd()

#create file
df_seed <- read.table("FieldBreakData.txt",header=TRUE)
head(df_seed)
summary(df_seed)

df_seed %>%
  filter(Plot==1)



```

Adjust formats and calculate the percentage of germinated seeds 
```{r}
# change format with basic R 
#df_seed$Date <- dmy(df_seed$Date)

# jeito 2 de trocar formato (usando dplyr)
df_seed <- df_seed %>%
  mutate(Plot = as.factor(Plot), Block = as.factor(Block)) %>%
#  mutate(Soft = as.numeric(Soft)) %>%
  mutate(PropSoft = round(Germinated/NumberSeedsPerBag*100,digits=2))

summary(df_seed) # explore values
str(df_seed) # check formats
head(df_seed) # see to rows
tail(df_seed)

df_seed %>%
  filter(Plot==1)
```

Calculate and Graph the potential Hardseeds (hardseed = 100 - Propsoftseeds) 
111 Days here was selected to be the first autumn measurement as the hardseeds percentage (compare with the laboratory results! )

```{r, fig.height=5, fig.width=10}
df_seed %>%
  mutate(hardSeed = 100-PropSoft) %>%
  #mutate(SowingD = dmy(SowingD)) %>%
    filter(DAB == 111) %>%  #need to keep filter to get first and max hardseed percent
  #mutate(Depth = factor(Depth,levels=c( "Above","Below"))) %>%
  group_by(Cultivar) %>%
  dplyr::select(hardSeed) %>%
  summarise_each(funs(mean,sd)) %>%
  ggplot(aes(x=Cultivar, y=mean, colour=factor(Cultivar), shape=factor(Cultivar))) +
  geom_point() +
  geom_line() +
 #facet_grid(.~Depth) +
  labs(x="DAB",y="Maximum Percentage of Hardseeds") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))+
  geom_errorbar(aes(ymin=mean-sd/2,
                    ymax=mean+sd/2))+
  theme_bw()+
  ylim(0,100)

head(df_seed)

summary(df_seed)

```

Calculate the cumulative number of germinated seeds 

```{r, warning=FALSE}

g1 <- df_seed %>%
  dplyr::select(-SowingDate) %>% #
  group_by(Cultivar, Plot) %>% # need to keep level in which cumulation occurs
  arrange(DAB) %>% # need to tell which factor to accumulate within
  mutate(Germ_cum = cumsum(Germinated)) %>%
  mutate(PercSoftCum=Germ_cum/NumberSeedsPerBag)%>%
  group_by(Cultivar, DAB) %>%
  summarise_each(funs(mean)) 
```

graph the Cummulative percentage of seedlings 


```{r ,CreatePercentHard}

summary (g1)

# per round
g1 %>%
  ungroup() %>%
#mutate(Depth = factor(Depth,levels=c( "Above","Below"))) %>%
ggplot(aes(x=DAB, y=100*(PercSoftCum), colour=Cultivar, shape=Cultivar)) +
  geom_point() +
  geom_line() +
  #facet_grid(Depth~SowTreat) +
  theme_bw()+
  ylim(0,60)+
  #geom_vline(xintercept = 5, linetype=2)+
   labs(x="Days",y="Cumulative Percentage of Seedlings")



```




```{r}

summary (g1)

g2 <- g1 %>%
 mutate(CumhardSeed = 100*(1-PercSoftCum)) %>%
group_by(Cultivar, DAB) %>%
  dplyr::select(CumhardSeed , DAB) %>%
  summarise_each(funs(mean,sd)) 

summary (g2) 

g2 %>%
  ggplot(aes(x=DAB, y=mean, colour=factor(Cultivar), shape=factor(Cultivar))) +
  geom_point() +
  geom_line() +
 #facet_grid(.~Depth) +
  labs(x="DAB",y="Percentage of Hardseeds") +
  theme(axis.text.x = element_text(angle = 90, hjust = 1))+
  geom_errorbar(aes(ymin=sd/2,
                    ymax=sd/2))+
  theme_bw()+
  ylim(0,100)






```

```{r}


g1 %>%
  dplyr::select(Plot,PercSoftCum,Cultivar, SowTreat,DAB) %>%
  #tidyr::spread(Depth, PercSoftCum) %>%
  ggplot(aes(x=DAB,y=PercSoftCum))+
  geom_point(aes(colour=factor(Cultivar))) +
  stat_smooth(method = "lm") +
  facet_grid(SowTreat~.)


#Check for outliers _Boxplot 
# df_seed %>%
#   ggplot(aes(x=Cultivar, y=Soft, colour=factor(SowTreat)))+
#   geom_boxplot() +
#   geom_jitter() +
#   theme(axis.text.x=element_text(angle = +90, hjust = 0))+
#   facet_grid(SowTreat~Depth+Round)
```

This script ends here. 
Analysis in script 2 


